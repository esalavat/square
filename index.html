<!DOCTYPE html>
<html>

<head>
    <title>Square</title>
</head>

<body>
    <canvas id="game-canvas" width="800" height="800"></canvas>
    <script>
        const game = (() => {

            //Settings
            const squareHeight = 100;
            const squareWidth = 100;
            const squareSpacing = 5;

            const squareAreaXOffset = 100;
            const squareAreaYOffset = 100;

            //Classes
            function Color(id, color, colorCode) {
                this.id = id;
                this.color = color;
                this.colorCode = colorCode;
            }

            function Square(x, y, colorX, colorY, level) {
                this.x = x;
                this.y = y;
                this.colorX = colorX;
                this.colorY = colorY;
                this.level = level;
            }

            Square.prototype.update = function () {

            }

            Square.prototype.render = function (ctx) {
                //console.log("Rendering x, y: ", this.x, this.y);
                ctx.beginPath();
                ctx.rect(this.x, this.y, squareWidth, squareHeight);
                ctx.stroke();

                drawTriangleFilled(ctx, this.x, this.y, this.x + squareWidth, this.y, this.x + squareWidth, this.y + squareHeight, game.colors[this.colorX].colorCode);
                drawTriangleFilled(ctx, this.x, this.y, this.x, this.y + squareHeight, this.x + squareWidth, this.y + squareHeight, game.colors[this.colorY].colorCode);
            };

            //Utilities
            function drawTriangleFilled(ctx, x1, y1, x2, y2, x3, y3, color) {
                ctx.beginPath();
                ctx.moveTo(x1, y1);
                ctx.lineTo(x2, y2);
                ctx.lineTo(x3, y3);
                ctx.fillStyle = color;
                ctx.fill();

            }

            //Game

            function createGrid(width, height) {
                let grid = [];

                for (let i = 0; i < width; i++) {
                    for (let j = 0; j < height; j++) {
                        grid.push(new Square(
                            squareAreaXOffset + (i * (squareWidth + squareSpacing)),
                            squareAreaYOffset + (j * (squareHeight + squareSpacing)),
                            i,
                            4 + j,
                            0
                        ));
                    }
                }

                grid[0].level = 1;

                return grid;
            }

            let game = {};

            game.update = () => {
                for (let object of game.objects) {
                    object.update();
                }
            }

            game.render = () => {
                game.ctx.clearRect(0, 0, game.canvas.width, game.canvas.height);

                for (let object of game.objects) {
                    object.render(game.ctx);
                }

                for (let x = 0; x < 4; x++) {
                    game.ctx.beginPath();
                    game.ctx.rect((100+squareSpacing)*x+125, 25, 50, 50);
                    game.ctx.fillStyle = game.colors[x].colorCode;
                    game.ctx.fill();
                }
                
                for (let y = 0; y < 4; y++) {
                    game.ctx.beginPath();
                    game.ctx.rect(25, (100+squareSpacing)*y+125, 50, 50);
                    game.ctx.fillStyle = game.colors[4+y].colorCode;
                    game.ctx.fill();
                }
            }

            game.loop = () => {
                window.requestAnimationFrame(game.loop);
                game.render(game.ctx);
            }

            game.init = () => {

                game.canvas = document.getElementById("game-canvas");
                game.ctx = game.canvas.getContext("2d");

                game.colors = {
                    "0": new Color(0, "blue", "#6d9efc"),
                    "1": new Color(1, "pink", "#f78ef0"),
                    "2": new Color(2, "green", "#98f786"),
                    "3": new Color(3, "Purple", "#937df8"),
                    "4": new Color(4, "red", "#fb7b77"),
                    "5": new Color(5, "light-blue", "#69EBFC"),
                    "6": new Color(6, "orange", "#fdc170"),
                    "7": new Color(7, "yellow", "#f3f87f")
                };

                game.objects = createGrid(4, 4);

                setInterval(game.update, 16);
                game.loop();
            }

            return {
                init: game.init
            };
        })();

        document.addEventListener("DOMContentLoaded", (event) => {
            game.init();
        });
    </script>
</body>

</html>